<template name="sources_show_format_page">
  {{#with source}}
    {{#if streamChain}}
    <section class='edit-stream-chain'>
      <section class='stream-chain'>
        <textarea class='code code-block' id='streamChain'>{{stringify streamChain}}</textarea>
      </section>

      <aside>
        <header>
          <ul class='errors is-empty'>
          </ul>

          {{#unless source.hasRunningImport}}
            {{#if source.hasDownloadStep}}
              <button class='btn js-start-import btn btn-primary btn-inline'>Start</button>

              {{> fileUpload
                    additionalCSSClasses='btn btn-primary'
                    accept=source.inputMimeType
                    metadata=fileMetadata
                    callbacks=fileCallbacks
              }}

              {{#if source.isDraft}}
                <p>
                  Your data will only be visible to members of {{source.getOrganization.name}} as your source is set to draft mode.
                </p>
              {{/if}}
            {{else}}
              <p>
                Your source import flow is still missing a <code>HTTPDownload</code> step. Please add it to enable importing your data.
              </p>
            {{/if}}
          {{/unless}}
        </header>

        {{#if lastSourceImport}}
          {{#with lastSourceImport}}
            {{> sources_stream_chain}}
          {{else}}
            <h2>{{_"Latest Import"}}</h2>
            <p class='placeholder'>{{_"Here you will see your last imports"}}</p>
          {{/with}}
        {{else}}
          <p>
            Please insert a JSON that describes the data flow from your input source into the accessibility.cloud database on the left side.
          </p>
        {{/if}}
      </aside>
    </section>
    {{else}}
      <section class='page-content centered load-default-json'>
        <div class='block'>
          <h1>Select your data format</h1>
          <p>
            <form>
            <table class='formats'>
              <tbody>
                {{#each keyValues importFlowTemplates}}
                  <tr>
                    <td>
                      <label>
                        <input name='format' type='radio' value='{{key}}'>&nbsp;{{value.name}}
                      </label>
                    </td>
                    <td>
                      {{#markdown}}{{value.descriptionMarkdown}}{{/markdown}}
                    </td>
                  </tr>
                {{/each}}
              </tbody>
            </table>
            <button class='btn btn-primary js-set-format'>Set format</button>
            </form>
          </p>

          <p>
            Your format is not listed here or more complex? Feel free to <a href='mailto:support@accessibility.cloud'>contact us</a> so we can assist you with the setup. ‚úåüèº
          </p>
        </div>
      </section>
    {{/if}}
  {{/with}}
</template>
